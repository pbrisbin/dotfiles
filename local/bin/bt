#!/bin/sh
#
# Despite what I do in bluez-monitor.conf, my Bluetooth headset always sets
# itself up as a2dp_sink, which means no mic. This switches it to headset, if
# necessary.
#
###
set -eu

card=$(pactl list short cards | awk '/bluez/ { print $1 }')
profile=headset-head-unit-msbc

if [ -z "$card" ]; then
  echo "No bluez card found" >&2
  exit 1
fi

if pactl list cards | grep -Fq "Active Profile: $profile"; then
  echo "Card already set to $profile"
  exit 0
fi

echo "Setting card #$card to $profile"
exec pactl set-card-profile "$card" "$profile"
